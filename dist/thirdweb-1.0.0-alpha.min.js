!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e=e||self).thirdweb={})}(this,(function(e){"use strict";function t(e){this.message=e}t.prototype=new Error,t.prototype.name="InvalidCharacterError";var n="undefined"!=typeof window&&window.atob&&window.atob.bind(window)||function(e){var n=String(e).replace(/=+$/,"");if(n.length%4==1)throw new t("'atob' failed: The string to be decoded is not correctly encoded.");for(var o,i,r=0,a=0,s="";i=n.charAt(a++);~i&&(o=r%4?64*o+i:i,r++%4)?s+=String.fromCharCode(255&o>>(-2*r&6)):0)i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(i);return s};var o=function(e){var t=e.replace(/-/g,"+").replace(/_/g,"/");switch(t.length%4){case 0:break;case 2:t+="==";break;case 3:t+="=";break;default:throw"Illegal base64url string!"}try{return function(e){return decodeURIComponent(n(e).replace(/(.)/g,(function(e,t){var n=t.charCodeAt(0).toString(16).toUpperCase();return n.length<2&&(n="0"+n),"%"+n})))}(t)}catch(e){return n(t)}};function i(e){this.message=e}i.prototype=new Error,i.prototype.name="InvalidTokenError";var r=function(e,t){if("string"!=typeof e)throw new i("Invalid token specified");var n=!0===(t=t||{}).header?0:1;try{return JSON.parse(o(e.split(".")[n]))}catch(e){throw new i("Invalid token specified: "+e.message)}};r.InvalidTokenError=i;
/**
    postmate - A powerful, simple, promise-based postMessage library
    @version v1.5.2
    @link https://github.com/dollarshaveclub/postmate
    @author Jacob Kelley <jakie8@gmail.com>
    @license MIT
  **/
var a="application/x-postmate-v1+json",s=0,d={handshake:1,"handshake-reply":1,call:1,emit:1,reply:1,request:1},c=function(e,t){return("string"!=typeof t||e.origin===t)&&(!!e.data&&(("object"!=typeof e.data||"postmate"in e.data)&&(e.data.type===a&&!!d[e.data.postmate])))},h=function(){function e(e){var t=this;this.parent=e.parent,this.frame=e.frame,this.child=e.child,this.childOrigin=e.childOrigin,this.events={},this.listener=function(e){if(!c(e,t.childOrigin))return!1;var n=((e||{}).data||{}).value||{},o=n.data,i=n.name;"emit"===e.data.postmate&&i in t.events&&t.events[i].call(t,o)},this.parent.addEventListener("message",this.listener,!1)}var t=e.prototype;return t.get=function(e){var t=this;return new p.Promise((function(n){var o=++s;t.parent.addEventListener("message",(function e(i){i.data.uid===o&&"reply"===i.data.postmate&&(t.parent.removeEventListener("message",e,!1),n(i.data.value))}),!1),t.child.postMessage({postmate:"request",type:a,property:e,uid:o},t.childOrigin)}))},t.call=function(e,t){this.child.postMessage({postmate:"call",type:a,property:e,data:t},this.childOrigin)},t.on=function(e,t){this.events[e]=t},t.destroy=function(){window.removeEventListener("message",this.listener,!1),this.frame.parentNode.removeChild(this.frame)},e}(),l=function(){function e(e){var t=this;this.model=e.model,this.parent=e.parent,this.parentOrigin=e.parentOrigin,this.child=e.child,this.child.addEventListener("message",(function(e){if(c(e,t.parentOrigin)){var n=e.data,o=n.property,i=n.uid,r=n.data;"call"!==e.data.postmate?function(e,t){var n="function"==typeof e[t]?e[t]():e[t];return p.Promise.resolve(n)}(t.model,o).then((function(t){return e.source.postMessage({property:o,postmate:"reply",type:a,uid:i,value:t},e.origin)})):o in t.model&&"function"==typeof t.model[o]&&t.model[o](r)}}))}return e.prototype.emit=function(e,t){this.parent.postMessage({postmate:"emit",type:a,value:{name:e,data:t}},this.parentOrigin)},e}(),p=function(){function e(e){var t=e.container,n=void 0===t?void 0!==n?n:document.body:t,o=e.model,i=e.url,r=e.name,a=e.classListArray,s=void 0===a?[]:a;return this.parent=window,this.frame=document.createElement("iframe"),this.frame.name=r||"",this.frame.classList.add.apply(this.frame.classList,s),n.appendChild(this.frame),this.child=this.frame.contentWindow||this.frame.contentDocument.parentWindow,this.model=o||{},this.sendHandshake(i)}return e.prototype.sendHandshake=function(t){var n,o=this,i=function(e){var t=document.createElement("a");t.href=e;var n=t.protocol.length>4?t.protocol:window.location.protocol,o=t.host.length?"80"===t.port||"443"===t.port?t.hostname:t.host:window.location.host;return t.origin||n+"//"+o}(t),r=0;return new e.Promise((function(e,s){o.parent.addEventListener("message",(function t(r){return!!c(r,i)&&("handshake-reply"===r.data.postmate?(clearInterval(n),o.parent.removeEventListener("message",t,!1),o.childOrigin=r.origin,e(new h(o))):s("Failed handshake"))}),!1);var d=function(){r++,o.child.postMessage({postmate:"handshake",type:a,model:o.model},i),5===r&&clearInterval(n)},l=function(){d(),n=setInterval(d,500)};o.frame.attachEvent?o.frame.attachEvent("onload",l):o.frame.onload=l,o.frame.src=t}))},e}();p.debug=!1,p.Promise=function(){try{return window?window.Promise:Promise}catch(e){return null}}(),p.Model=function(){function e(e){return this.child=window,this.model=e,this.parent=this.child.parent,this.sendHandshakeReply()}return e.prototype.sendHandshakeReply=function(){var e=this;return new p.Promise((function(t,n){e.child.addEventListener("message",(function o(i){if(i.data.postmate){if("handshake"===i.data.postmate){e.child.removeEventListener("message",o,!1),i.source.postMessage({postmate:"handshake-reply",type:a},i.origin),e.parentOrigin=i.origin;var r=i.data.model;return r&&Object.keys(r).forEach((function(t){e.model[t]=r[t]})),t(new l(e))}return n("Handshake Reply Failed")}}),!1)}))},e}();var u={connectUrl:"https://connect.thirdweb.co/"};var f=function(){function e(e){var t=this;void 0===e&&(e=u),this.config=e,this.token=null,this.autopay=null,this.processRedirectResult(),this.embedThirdweb(),this.loadToken(),this.token&&this.handshake.then((function(e){e.call("setClaimToken",t.token)}))}return e.prototype.processRedirectResult=function(){var e=window.location.hash.match(/#?&?thirdweb_token=([A-Za-z0-9-_=]+\.[A-Za-z0-9-_=]+\.?[A-Za-z0-9-_.+/=]*)$/);if(e){localStorage.setItem("thirdweb_token",e[1]);var t=window.location.href.substring(0,window.location.href.length-e[0].length);window.location.replace(t)}},e.prototype.embedThirdweb=function(){var e=this;this.handshake=new p({container:document.body,url:this.config.connectUrl,classListArray:["thirdweb-frame"]});var t=document.querySelector(".thirdweb-frame");t.style.border="none",t.style.backgroundColor="transparent",t.style.position="fixed",t.style.right="0px",t.style.top="40px",t.style.overflow="none",this.handshake.then((function(t){t.on("size-changed",(function(e){t.frame.style.width=e.width+"px",t.frame.style.height=e.height+"px"})),t.on("position-changed",(function(e){t.frame.style.top=e.top+"px"})),t.on("login",e.loginRequest.bind(e)),t.on("logout",e.logoutRequest.bind(e))}))},e.prototype.loginRequest=function(e){["facebook","google"].includes(e.provider)&&window.location.replace(this.config.connectUrl+"auth.html#auth_type="+e.provider+"&redirect_uri="+window.location.href)},e.prototype.logoutRequest=function(){localStorage.removeItem("thirdweb_token"),window.location.replace(this.config.connectUrl+"auth.html#auth_type=logout&redirect_uri="+window.location.href)},e.prototype.loadToken=function(){var e=localStorage.getItem("thirdweb_token");if(!e)return null;var t=r(e);this.validateToken(t)||localStorage.removeItem("thirdweb_token"),this.token=e,this.autopay=t.autopay},e.prototype.validateToken=function(e){if("https://connect.thirdweb.co"!==e.iss)return!1;var t=window.location.href.match(/^(([^:/?#]+):)?(\/\/([^/?#]*))?([^?#]*)(\?([^#]*))?(#(.*))?/),n=t&&t[4];return e.aud===n&&(!(e.iat>=Date.now()/1e3)&&!(e.exp<=Date.now()/1e3))},e}();e.DefaultThirdwebConfig=u,e.Thirdweb=f,e.initialize=function(e){return void 0===e&&(e=u),new f(e)},Object.defineProperty(e,"__esModule",{value:!0})}));
