{"version":3,"file":"thirdweb-1.0.0-alpha.min.js","sources":["../node_modules/jwt-decode/lib/atob.js","../node_modules/jwt-decode/lib/base64_url_decode.js","../node_modules/jwt-decode/lib/index.js","../node_modules/postmate/build/postmate.es.js","../src/main.ts"],"sourcesContent":["/**\n * The code was extracted from:\n * https://github.com/davidchambers/Base64.js\n */\n\nvar chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=';\n\nfunction InvalidCharacterError(message) {\n  this.message = message;\n}\n\nInvalidCharacterError.prototype = new Error();\nInvalidCharacterError.prototype.name = 'InvalidCharacterError';\n\nfunction polyfill (input) {\n  var str = String(input).replace(/=+$/, '');\n  if (str.length % 4 == 1) {\n    throw new InvalidCharacterError(\"'atob' failed: The string to be decoded is not correctly encoded.\");\n  }\n  for (\n    // initialize result and counters\n    var bc = 0, bs, buffer, idx = 0, output = '';\n    // get next character\n    buffer = str.charAt(idx++);\n    // character found in table? initialize bit storage and add its ascii value;\n    ~buffer && (bs = bc % 4 ? bs * 64 + buffer : buffer,\n      // and if not first of each 4 characters,\n      // convert the first 8 bits to one ascii character\n      bc++ % 4) ? output += String.fromCharCode(255 & bs >> (-2 * bc & 6)) : 0\n  ) {\n    // try to find character in table (0-63, not found => -1)\n    buffer = chars.indexOf(buffer);\n  }\n  return output;\n}\n\n\nmodule.exports = typeof window !== 'undefined' && window.atob && window.atob.bind(window) || polyfill;\n","var atob = require('./atob');\n\nfunction b64DecodeUnicode(str) {\n  return decodeURIComponent(atob(str).replace(/(.)/g, function (m, p) {\n    var code = p.charCodeAt(0).toString(16).toUpperCase();\n    if (code.length < 2) {\n      code = '0' + code;\n    }\n    return '%' + code;\n  }));\n}\n\nmodule.exports = function(str) {\n  var output = str.replace(/-/g, \"+\").replace(/_/g, \"/\");\n  switch (output.length % 4) {\n    case 0:\n      break;\n    case 2:\n      output += \"==\";\n      break;\n    case 3:\n      output += \"=\";\n      break;\n    default:\n      throw \"Illegal base64url string!\";\n  }\n\n  try{\n    return b64DecodeUnicode(output);\n  } catch (err) {\n    return atob(output);\n  }\n};\n","'use strict';\n\nvar base64_url_decode = require('./base64_url_decode');\n\nfunction InvalidTokenError(message) {\n  this.message = message;\n}\n\nInvalidTokenError.prototype = new Error();\nInvalidTokenError.prototype.name = 'InvalidTokenError';\n\nmodule.exports = function (token,options) {\n  if (typeof token !== 'string') {\n    throw new InvalidTokenError('Invalid token specified');\n  }\n\n  options = options || {};\n  var pos = options.header === true ? 0 : 1;\n  try {\n    return JSON.parse(base64_url_decode(token.split('.')[pos]));\n  } catch (e) {\n    throw new InvalidTokenError('Invalid token specified: ' + e.message);\n  }\n};\n\nmodule.exports.InvalidTokenError = InvalidTokenError;\n","/**\n  postmate - A powerful, simple, promise-based postMessage library\n  @version v1.5.2\n  @link https://github.com/dollarshaveclub/postmate\n  @author Jacob Kelley <jakie8@gmail.com>\n  @license MIT\n**/\n/**\n * The type of messages our frames our sending\n * @type {String}\n */\nvar messageType = 'application/x-postmate-v1+json';\n/**\n * The maximum number of attempts to send a handshake request to the parent\n * @type {Number}\n */\n\nvar maxHandshakeRequests = 5;\n/**\n * A unique message ID that is used to ensure responses are sent to the correct requests\n * @type {Number}\n */\n\nvar _messageId = 0;\n/**\n * Increments and returns a message ID\n * @return {Number} A unique ID for a message\n */\n\nvar generateNewMessageId = function generateNewMessageId() {\n  return ++_messageId;\n};\n/**\n * Postmate logging function that enables/disables via config\n * @param  {Object} ...args Rest Arguments\n */\n\nvar log = function log() {\n  var _console;\n\n  return Postmate.debug ? (_console = console).log.apply(_console, arguments) : null;\n}; // eslint-disable-line no-console\n\n/**\n * Takes a URL and returns the origin\n * @param  {String} url The full URL being requested\n * @return {String}     The URLs origin\n */\n\nvar resolveOrigin = function resolveOrigin(url) {\n  var a = document.createElement('a');\n  a.href = url;\n  var protocol = a.protocol.length > 4 ? a.protocol : window.location.protocol;\n  var host = a.host.length ? a.port === '80' || a.port === '443' ? a.hostname : a.host : window.location.host;\n  return a.origin || protocol + \"//\" + host;\n};\nvar messageTypes = {\n  handshake: 1,\n  'handshake-reply': 1,\n  call: 1,\n  emit: 1,\n  reply: 1,\n  request: 1\n  /**\n   * Ensures that a message is safe to interpret\n   * @param  {Object} message The postmate message being sent\n   * @param  {String|Boolean} allowedOrigin The whitelisted origin or false to skip origin check\n   * @return {Boolean}\n   */\n\n};\nvar sanitize = function sanitize(message, allowedOrigin) {\n  if (typeof allowedOrigin === 'string' && message.origin !== allowedOrigin) return false;\n  if (!message.data) return false;\n  if (typeof message.data === 'object' && !('postmate' in message.data)) return false;\n  if (message.data.type !== messageType) return false;\n  if (!messageTypes[message.data.postmate]) return false;\n  return true;\n};\n/**\n * Takes a model, and searches for a value by the property\n * @param  {Object} model     The dictionary to search against\n * @param  {String} property  A path within a dictionary (i.e. 'window.location.href')\n * @param  {Object} data      Additional information from the get request that is\n *                            passed to functions in the child model\n * @return {Promise}\n */\n\nvar resolveValue = function resolveValue(model, property) {\n  var unwrappedContext = typeof model[property] === 'function' ? model[property]() : model[property];\n  return Postmate.Promise.resolve(unwrappedContext);\n};\n/**\n * Composes an API to be used by the parent\n * @param {Object} info Information on the consumer\n */\n\nvar ParentAPI =\n/*#__PURE__*/\nfunction () {\n  function ParentAPI(info) {\n    var _this = this;\n\n    this.parent = info.parent;\n    this.frame = info.frame;\n    this.child = info.child;\n    this.childOrigin = info.childOrigin;\n    this.events = {};\n\n    if (process.env.NODE_ENV !== 'production') {\n      log('Parent: Registering API');\n      log('Parent: Awaiting messages...');\n    }\n\n    this.listener = function (e) {\n      if (!sanitize(e, _this.childOrigin)) return false;\n      /**\n       * the assignments below ensures that e, data, and value are all defined\n       */\n\n      var _ref = ((e || {}).data || {}).value || {},\n          data = _ref.data,\n          name = _ref.name;\n\n      if (e.data.postmate === 'emit') {\n        if (process.env.NODE_ENV !== 'production') {\n          log(\"Parent: Received event emission: \" + name);\n        }\n\n        if (name in _this.events) {\n          _this.events[name].call(_this, data);\n        }\n      }\n    };\n\n    this.parent.addEventListener('message', this.listener, false);\n\n    if (process.env.NODE_ENV !== 'production') {\n      log('Parent: Awaiting event emissions from Child');\n    }\n  }\n\n  var _proto = ParentAPI.prototype;\n\n  _proto.get = function get(property) {\n    var _this2 = this;\n\n    return new Postmate.Promise(function (resolve) {\n      // Extract data from response and kill listeners\n      var uid = generateNewMessageId();\n\n      var transact = function transact(e) {\n        if (e.data.uid === uid && e.data.postmate === 'reply') {\n          _this2.parent.removeEventListener('message', transact, false);\n\n          resolve(e.data.value);\n        }\n      }; // Prepare for response from Child...\n\n\n      _this2.parent.addEventListener('message', transact, false); // Then ask child for information\n\n\n      _this2.child.postMessage({\n        postmate: 'request',\n        type: messageType,\n        property: property,\n        uid: uid\n      }, _this2.childOrigin);\n    });\n  };\n\n  _proto.call = function call(property, data) {\n    // Send information to the child\n    this.child.postMessage({\n      postmate: 'call',\n      type: messageType,\n      property: property,\n      data: data\n    }, this.childOrigin);\n  };\n\n  _proto.on = function on(eventName, callback) {\n    this.events[eventName] = callback;\n  };\n\n  _proto.destroy = function destroy() {\n    if (process.env.NODE_ENV !== 'production') {\n      log('Parent: Destroying Postmate instance');\n    }\n\n    window.removeEventListener('message', this.listener, false);\n    this.frame.parentNode.removeChild(this.frame);\n  };\n\n  return ParentAPI;\n}();\n/**\n * Composes an API to be used by the child\n * @param {Object} info Information on the consumer\n */\n\nvar ChildAPI =\n/*#__PURE__*/\nfunction () {\n  function ChildAPI(info) {\n    var _this3 = this;\n\n    this.model = info.model;\n    this.parent = info.parent;\n    this.parentOrigin = info.parentOrigin;\n    this.child = info.child;\n\n    if (process.env.NODE_ENV !== 'production') {\n      log('Child: Registering API');\n      log('Child: Awaiting messages...');\n    }\n\n    this.child.addEventListener('message', function (e) {\n      if (!sanitize(e, _this3.parentOrigin)) return;\n\n      if (process.env.NODE_ENV !== 'production') {\n        log('Child: Received request', e.data);\n      }\n\n      var _e$data = e.data,\n          property = _e$data.property,\n          uid = _e$data.uid,\n          data = _e$data.data;\n\n      if (e.data.postmate === 'call') {\n        if (property in _this3.model && typeof _this3.model[property] === 'function') {\n          _this3.model[property](data);\n        }\n\n        return;\n      } // Reply to Parent\n\n\n      resolveValue(_this3.model, property).then(function (value) {\n        return e.source.postMessage({\n          property: property,\n          postmate: 'reply',\n          type: messageType,\n          uid: uid,\n          value: value\n        }, e.origin);\n      });\n    });\n  }\n\n  var _proto2 = ChildAPI.prototype;\n\n  _proto2.emit = function emit(name, data) {\n    if (process.env.NODE_ENV !== 'production') {\n      log(\"Child: Emitting Event \\\"\" + name + \"\\\"\", data);\n    }\n\n    this.parent.postMessage({\n      postmate: 'emit',\n      type: messageType,\n      value: {\n        name: name,\n        data: data\n      }\n    }, this.parentOrigin);\n  };\n\n  return ChildAPI;\n}();\n/**\n  * The entry point of the Parent.\n * @type {Class}\n */\n\nvar Postmate =\n/*#__PURE__*/\nfunction () {\n  // eslint-disable-line no-undef\n  // Internet Explorer craps itself\n\n  /**\n   * Sets options related to the Parent\n   * @param {Object} object The element to inject the frame into, and the url\n   * @return {Promise}\n   */\n  function Postmate(_ref2) {\n    var _ref2$container = _ref2.container,\n        container = _ref2$container === void 0 ? typeof container !== 'undefined' ? container : document.body : _ref2$container,\n        model = _ref2.model,\n        url = _ref2.url,\n        name = _ref2.name,\n        _ref2$classListArray = _ref2.classListArray,\n        classListArray = _ref2$classListArray === void 0 ? [] : _ref2$classListArray;\n    // eslint-disable-line no-undef\n    this.parent = window;\n    this.frame = document.createElement('iframe');\n    this.frame.name = name || '';\n    this.frame.classList.add.apply(this.frame.classList, classListArray);\n    container.appendChild(this.frame);\n    this.child = this.frame.contentWindow || this.frame.contentDocument.parentWindow;\n    this.model = model || {};\n    return this.sendHandshake(url);\n  }\n  /**\n   * Begins the handshake strategy\n   * @param  {String} url The URL to send a handshake request to\n   * @return {Promise}     Promise that resolves when the handshake is complete\n   */\n\n\n  var _proto3 = Postmate.prototype;\n\n  _proto3.sendHandshake = function sendHandshake(url) {\n    var _this4 = this;\n\n    var childOrigin = resolveOrigin(url);\n    var attempt = 0;\n    var responseInterval;\n    return new Postmate.Promise(function (resolve, reject) {\n      var reply = function reply(e) {\n        if (!sanitize(e, childOrigin)) return false;\n\n        if (e.data.postmate === 'handshake-reply') {\n          clearInterval(responseInterval);\n\n          if (process.env.NODE_ENV !== 'production') {\n            log('Parent: Received handshake reply from Child');\n          }\n\n          _this4.parent.removeEventListener('message', reply, false);\n\n          _this4.childOrigin = e.origin;\n\n          if (process.env.NODE_ENV !== 'production') {\n            log('Parent: Saving Child origin', _this4.childOrigin);\n          }\n\n          return resolve(new ParentAPI(_this4));\n        } // Might need to remove since parent might be receiving different messages\n        // from different hosts\n\n\n        if (process.env.NODE_ENV !== 'production') {\n          log('Parent: Invalid handshake reply');\n        }\n\n        return reject('Failed handshake');\n      };\n\n      _this4.parent.addEventListener('message', reply, false);\n\n      var doSend = function doSend() {\n        attempt++;\n\n        if (process.env.NODE_ENV !== 'production') {\n          log(\"Parent: Sending handshake attempt \" + attempt, {\n            childOrigin: childOrigin\n          });\n        }\n\n        _this4.child.postMessage({\n          postmate: 'handshake',\n          type: messageType,\n          model: _this4.model\n        }, childOrigin);\n\n        if (attempt === maxHandshakeRequests) {\n          clearInterval(responseInterval);\n        }\n      };\n\n      var loaded = function loaded() {\n        doSend();\n        responseInterval = setInterval(doSend, 500);\n      };\n\n      if (_this4.frame.attachEvent) {\n        _this4.frame.attachEvent('onload', loaded);\n      } else {\n        _this4.frame.onload = loaded;\n      }\n\n      if (process.env.NODE_ENV !== 'production') {\n        log('Parent: Loading frame', {\n          url: url\n        });\n      }\n\n      _this4.frame.src = url;\n    });\n  };\n\n  return Postmate;\n}();\n/**\n * The entry point of the Child\n * @type {Class}\n */\n\n\nPostmate.debug = false;\n\nPostmate.Promise = function () {\n  try {\n    return window ? window.Promise : Promise;\n  } catch (e) {\n    return null;\n  }\n}();\n\nPostmate.Model =\n/*#__PURE__*/\nfunction () {\n  /**\n   * Initializes the child, model, parent, and responds to the Parents handshake\n   * @param {Object} model Hash of values, functions, or promises\n   * @return {Promise}       The Promise that resolves when the handshake has been received\n   */\n  function Model(model) {\n    this.child = window;\n    this.model = model;\n    this.parent = this.child.parent;\n    return this.sendHandshakeReply();\n  }\n  /**\n   * Responds to a handshake initiated by the Parent\n   * @return {Promise} Resolves an object that exposes an API for the Child\n   */\n\n\n  var _proto4 = Model.prototype;\n\n  _proto4.sendHandshakeReply = function sendHandshakeReply() {\n    var _this5 = this;\n\n    return new Postmate.Promise(function (resolve, reject) {\n      var shake = function shake(e) {\n        if (!e.data.postmate) {\n          return;\n        }\n\n        if (e.data.postmate === 'handshake') {\n          if (process.env.NODE_ENV !== 'production') {\n            log('Child: Received handshake from Parent');\n          }\n\n          _this5.child.removeEventListener('message', shake, false);\n\n          if (process.env.NODE_ENV !== 'production') {\n            log('Child: Sending handshake reply to Parent');\n          }\n\n          e.source.postMessage({\n            postmate: 'handshake-reply',\n            type: messageType\n          }, e.origin);\n          _this5.parentOrigin = e.origin; // Extend model with the one provided by the parent\n\n          var defaults = e.data.model;\n\n          if (defaults) {\n            Object.keys(defaults).forEach(function (key) {\n              _this5.model[key] = defaults[key];\n            });\n\n            if (process.env.NODE_ENV !== 'production') {\n              log('Child: Inherited and extended model from Parent');\n            }\n          }\n\n          if (process.env.NODE_ENV !== 'production') {\n            log('Child: Saving Parent origin', _this5.parentOrigin);\n          }\n\n          return resolve(new ChildAPI(_this5));\n        }\n\n        return reject('Handshake Reply Failed');\n      };\n\n      _this5.child.addEventListener('message', shake, false);\n    });\n  };\n\n  return Model;\n}();\n\nexport default Postmate;\n","import * as jwt_decode from 'jwt-decode';\r\nimport Postmate from 'postmate';\r\n\r\nexport function initialize(): Thirdweb {\r\n  return new Thirdweb();\r\n}\r\n\r\nexport interface ThirdwebConfig {\r\n  connectUrl: string;\r\n}\r\n\r\nexport interface AutoPay {\r\n  authorizeAmount: number;\r\n  currency: string;\r\n}\r\n\r\nexport interface LoginRequest {\r\n  provider: string;\r\n}\r\n\r\nexport interface Position {\r\n  left: number;\r\n  top: number;\r\n}\r\n\r\nexport interface Size {\r\n  width: number;\r\n  height: number;\r\n}\r\n\r\nexport interface TokenPayload {\r\n  iss: string;\r\n  aud: string;\r\n  iat: number;\r\n  exp: number;\r\n  autopay: AutoPay;\r\n}\r\n\r\nexport const DefaultThirdwebConfig: ThirdwebConfig = { connectUrl: 'https://connect.thirdweb.co/' };\r\n\r\nexport class Thirdweb {\r\n\r\n  private token: string | null = null;\r\n\r\n  private autopay: AutoPay | null = null;\r\n\r\n  private handshake: any;\r\n\r\n  constructor(private config = DefaultThirdwebConfig) {\r\n    this.processRedirectResult();\r\n    this.embedThirdweb();\r\n    this.loadToken();\r\n\r\n    if (this.token) {\r\n      this.handshake.then((child: any) => {\r\n        child.call('setClaimToken', this.token);\r\n      });\r\n    }\r\n  }\r\n\r\n  processRedirectResult() {\r\n    const match = window.location.hash.match(/#?&?thirdweb_token=([A-Za-z0-9-_=]+\\.[A-Za-z0-9-_=]+\\.?[A-Za-z0-9-_.+/=]*)$/);\r\n    if (match) {\r\n      localStorage.setItem('thirdweb_token', match[1]);\r\n      let url = window.location.href.substring(0, window.location.href.length - match[0].length);\r\n      window.location.replace(url);\r\n    }\r\n  }\r\n\r\n  embedThirdweb() {\r\n    this.handshake = new Postmate({\r\n      container: document.body,\r\n      url: this.config.connectUrl,\r\n      classListArray: ['thirdweb-frame'],\r\n    });\r\n\r\n    const frame = document.querySelector('.thirdweb-frame') as HTMLIFrameElement;\r\n    frame.style.border = 'none';\r\n    frame.style.backgroundColor = 'transparent';\r\n    frame.style.position = 'fixed';\r\n    frame.style.right = '0px';\r\n    frame.style.top = '40px';\r\n    frame.style.overflow = 'none';\r\n\r\n    this.handshake.then((child: any) => {\r\n      child.on('size-changed', (size: Size) => {\r\n        child.frame.style.width = `${size.width}px`;\r\n        child.frame.style.height = `${size.height}px`;\r\n      });\r\n\r\n      child.on('position-changed', (position: Position)  => {\r\n        child.frame.style.top = `${position.top}px`;\r\n      });\r\n\r\n      child.on('login', this.loginRequest.bind(this));\r\n\r\n      child.on('logout', this.logoutRequest.bind(this));\r\n    });\r\n  }\r\n\r\n  loginRequest(data: LoginRequest) {\r\n    if (['facebook', 'google'].includes(data.provider)) {\r\n      window.location.replace(`${this.config.connectUrl}auth.html#auth_type=${data.provider}&redirect_uri=${window.location.href}`);\r\n    }\r\n  }\r\n\r\n  logoutRequest() {\r\n    localStorage.removeItem('thirdweb_token');\r\n    window.location.replace(`${this.config.connectUrl}auth.html#auth_type=logout&redirect_uri=${window.location.href}`);\r\n  }\r\n\r\n  loadToken() {\r\n    const token = localStorage.getItem('thirdweb_token');\r\n    if (!token) {\r\n      return null;\r\n    }\r\n\r\n    const payload: TokenPayload = jwt_decode(token);\r\n    if (!this.validateToken(payload)) {\r\n      localStorage.removeItem('thirdweb_token');\r\n    }\r\n\r\n    this.token = token;\r\n    this.autopay = payload.autopay;\r\n  }\r\n\r\n  validateToken(payload: TokenPayload) {\r\n    if (payload.iss !== 'https://connect.thirdweb.co') {\r\n      return false;\r\n    }\r\n\r\n    // Taken from RFC 3986: https://tools.ietf.org/html/rfc3986#appendix-B\r\n    const match = window.location.href.match(/^(([^:/?#]+):)?(\\/\\/([^/?#]*))?([^?#]*)(\\?([^#]*))?(#(.*))?/);\r\n    const authority = match && match[4];\r\n    if (payload.aud !== authority) {\r\n      return false;\r\n    }\r\n\r\n    if (payload.iat >= Date.now() / 1000) {\r\n      return false;\r\n    }\r\n\r\n    if (payload.exp <= Date.now() / 1000) {\r\n      return false;\r\n    }\r\n\r\n    return true;\r\n  }\r\n}"],"names":["InvalidCharacterError","message","this","prototype","Error","name","window","atob","bind","input","str","String","replace","length","bs","buffer","bc","idx","output","charAt","fromCharCode","indexOf","decodeURIComponent","m","p","code","charCodeAt","toString","toUpperCase","b64DecodeUnicode","err","InvalidTokenError","token","options","pos","header","JSON","parse","base64_url_decode","split","e","messageType","_messageId","messageTypes","handshake","handshake-reply","call","emit","reply","request","sanitize","allowedOrigin","origin","data","type","postmate","ParentAPI","info","_this","parent","frame","child","childOrigin","events","listener","_ref","value","addEventListener","_proto","get","property","_this2","Postmate","Promise","resolve","uid","transact","removeEventListener","postMessage","on","eventName","callback","destroy","parentNode","removeChild","ChildAPI","_this3","model","parentOrigin","_e$data","unwrappedContext","resolveValue","then","source","_ref2","_ref2$container","container","document","body","url","_ref2$classListArray","classListArray","createElement","classList","add","apply","appendChild","contentWindow","contentDocument","parentWindow","sendHandshake","responseInterval","_this4","a","href","protocol","location","host","port","hostname","resolveOrigin","attempt","reject","clearInterval","doSend","loaded","setInterval","attachEvent","onload","src","debug","Model","sendHandshakeReply","_this5","shake","defaults","Object","keys","forEach","key","DefaultThirdwebConfig","connectUrl","config","processRedirectResult","embedThirdweb","loadToken","Thirdweb","match","hash","localStorage","setItem","substring","querySelector","style","border","backgroundColor","position","right","top","overflow","size","width","height","loginRequest","logoutRequest","includes","provider","removeItem","getItem","payload","jwt_decode","validateToken","autopay","iss","authority","aud","iat","Date","now","exp"],"mappings":"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"}